<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Python Editor (Pyodide)</title>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.10/codemirror.min.css" />
  <style>
    body { 
      font-family: Arial, sans-serif; 
      margin: 0;
      padding: 0;
      height: 100vh;
      display: flex;
      flex-direction: column;
    }
    h2 {
      text-align: center;
      padding: 20px;
      background-color: #f4f4f4;
      margin: 0;
    }
    .welcome-message {
      background-color: #4CAF50;
      color: white;
      padding: 10px;
      text-align: center;
      font-size: 1.2em;
      font-weight: bold;
    }
    .container {
      display: flex;
      flex: 1;  /* This makes it stretch to fill remaining space */
      flex-wrap: wrap;
    }
    .draggable {
      flex: 1;
      margin: 10px;
      padding: 10px;
      background-color: #f9f9f9;
      border: 1px solid #ccc;
      display: flex;
      flex-direction: column;
      justify-content: flex-start;
      min-width: 45%;  /* This ensures the sections are at least 45% wide */
      height: calc(100vh - 70px); /* Adjust height to the screen */
    }
    #editor { 
      height: calc(50vh - 20px);
    }
    #output {
      white-space: pre-wrap;
      padding: 10px;
      background-color: #f0f0f0;
      border-radius: 4px;
      flex-grow: 1;
    }
    #runBtn {
      padding: 8px 16px;
      cursor: pointer;
      align-self: center;
      background-color: #4CAF50;
      color: white;
      border: none;
      border-radius: 5px;
    }
    button:hover {
      background-color: #45a049;
    }
    @media screen and (max-width: 768px) {
      .container {
        flex-direction: column; /* Stack vertically on small screens */
      }
      .draggable {
        width: 100%; /* Make sections full width on small screens */
      }
    }
  </style>
</head>
<body>

  <!-- Welcome Message -->
  <div class="welcome-message">
    Welcome Learner, this is an interactive web Python interpreter by Bit and Pi channel
  </div>

  <h2>Try Python in Your Browser</h2>

  <div class="container">
    <div id="drag-editor" class="draggable" style="cursor: move;">
      <h3>Code Editor</h3>
      <textarea id="editor">print("Hello from Python!")</textarea><br>
    </div>

    <div id="drag-output" class="draggable" style="cursor: move;">
      <h3>Output:</h3>
      <div id="output">...</div>
    </div>
  </div>

  <button id="runBtn">▶ Run Code</button>

  <!-- CodeMirror -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.10/codemirror.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.10/mode/python/python.min.js"></script>

  <!-- Pyodide -->
  <script src="https://cdn.jsdelivr.net/pyodide/v0.23.4/full/pyodide.js"></script>

  <script>
    // Initialize CodeMirror
    const cm = CodeMirror.fromTextArea(document.getElementById("editor"), {
      mode: "python",
      lineNumbers: true,
      theme: "default",
      indentUnit: 4,
      tabSize: 4,
    });

    let pyodideReady = false;
    let pyodide = null;

    async function loadPyodideAndPackages() {
      pyodide = await loadPyodide();
      pyodideReady = true;
      document.getElementById("output").textContent = "✅ Pyodide loaded. You can now run Python code.";
    }

    loadPyodideAndPackages();

    // Function to redirect stdout to output div
    function redirectOutput() {
      pyodide.runPython(`
        import sys
        import io
        sys.stdout = io.StringIO()  // Redirect stdout to capture print statements
      `);
    }

    // Button click handler to run code
    document.getElementById("runBtn").addEventListener("click", async () => {
      const output = document.getElementById("output");

      if (!pyodideReady) {
        output.textContent = "⏳ Please wait, Pyodide is still loading...";
        return;
      }

      output.textContent = ""; // clear old output
      try {
        const code = cm.getValue();  // Get code from editor
        redirectOutput();  // Redirect stdout before running the code
        await pyodide.runPythonAsync(code);

        // Get the output and display it
        const result = pyodide.runPython('sys.stdout.getvalue()');  // Capture the stdout
        if (result !== undefined && result !== null) {
          output.textContent = result.toString();
        } else {
          output.textContent = "✅ Code executed successfully.";
        }
      } catch (err) {
        output.textContent = `❌ Error:\n${err.message || err}`;
      }
    });

    // Drag functionality (for customizability)
    let dragging = null;
    let offsetX = 0;
    let offsetY = 0;

    function makeDraggable(element) {
      element.addEventListener('mousedown', (e) => {
        dragging = element;
        offsetX = e.clientX - element.getBoundingClientRect().left;
        offsetY = e.clientY - element.getBoundingClientRect().top;

        document.addEventListener('mousemove', dragElement);
        document.addEventListener('mouseup', stopDragging);
      });
    }

    function dragElement(e) {
      if (dragging) {
        dragging.style.position = 'absolute';
        dragging.style.left = (e.clientX - offsetX) + 'px';
        dragging.style.top = (e.clientY - offsetY) + 'px';
      }
    }

    function stopDragging() {
      dragging = null;
      document.removeEventListener('mousemove', dragElement);
      document.removeEventListener('mouseup', stopDragging);
    }

    makeDraggable(document.getElementById('drag-editor'));
    makeDraggable(document.getElementById('drag-output'));
  </script>

</body>
</html>
